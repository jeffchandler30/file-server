<!-- LINT.IfChange -->
<html>
  <head>
    <style>
      .video { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
      }
      .container { 
        position: relative; 
        width: 100%; 
        height: 100%; 
        overflow: hidden; 
      }
  </style>
  </head>
  <body>
    <div class="container">
      <div id="player" class="video" frameborder="0"></div>
    </div>
    </div>
    <script>

      // Set up iframes using API.
      const tag = document.createElement("script");

      let params = (new URL(document.location)).searchParams;
      let videoId = params.get("videoId");
      let dashmpd = params.get("dashmpd");
      let autoplay = params.get("autoplay");
      let controls = params.get("controls");
      let muted = params.get("muted");

      console.log("Params: videoId", videoId, "dashmpd", dashmpd, "autoplay", autoplay, "controls", controls, "muted", muted)
      tag.src = "https://youtube.googleapis.com/iframe_api";
      const firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      let player;
      function onYouTubeIframeAPIReady() {

        let defaultConfig = {
          videoId: videoId,
          width: "100%",
          height: window.innerHeight,
          playerVars: {
            autoplay: autoplay === 1 || autoplay === "1" || autoplay === true ? 1 : 0,
            controls: controls === 1 || controls === "1" || controls === true ? 1 : 0,
            playsinline: 1,
            hl: "en",
            modestbranding: 0,
            rel: 1,
            dashmpd: dashmpd || undefined
          },
          events: {
              'onReady': onPlayerReady,
              'onStateChange': onPlayerStateChange,
              'onError': onPlayerError
            }
        };

        createOrUpdatePlayer(defaultConfig);
      }

      /**
       * Creates a new player or updates existing player using given player configs.
       * @param {obj} playerconfig used to pass configuration properties to the player.
       */
      function createOrUpdatePlayer(playerConfig) {
        if (!playerConfig) throw "player config can not be empty";

        const container = document.getElementById("player").parentNode;

        const newPlayer = document.createElement("div");
        newPlayer.setAttribute("id", "player");

        container.replaceChild(newPlayer, document.getElementById("player"));
    
        console.log("Creating new player", playerConfig)
        player = new YT.Player("player", playerConfig);
      }

      function onPlayerReady(event) {
        console.log("onPlayerReady",  event.data)
        if (muted) {
          console.log("Calling mute");
          player.mute();
        }
        if (autoplay) {
          console.log("Calling playVideo");
          player.playVideo();
        }
      }

      function onPlayerError(event) {
        console.log("onPlayerError",  event.data)
      }

      function onPlayerStateChange(event) {
        console.log("onPlayerStateChange", event.data)
      }

    </script>
  </body>
</html>
<!-- LINT.ThenChange(//depot/google3/video/youtube/web/embedded_player/appspot/pfp_test_appspot/templates/player.html) -->
